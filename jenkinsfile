def appname = "Runner" //DON'T CHANGE THIS. This refers to the flutter 'Runner' target.
def xcarchive = "${appname}.xcarchive"

pipeline {
    agent any
    environment {
        DEVELOPER_DIR="/Applications/Xcode.app/Contents/Developer/"  //This is necessary for Fastlane to access iOS Build things.
        PATH = "/Users/jenkins/.rbenv/shims:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Library/Apple/usr/bin:/Users/jenkins/Documents/flutter/bin:/usr/local/Caskroom/android-sdk/4333796//tools:/usr/local/Caskroom/android-sdk/4333796//platform-tools:/Applications/Xcode.app/Contents/Developer"
    }
    stages {

        stage ('Flutter Doctor') {
            steps {
                sh "flutter doctor -v"
            }
        }
        stage ('Flutter Build APK') {
            steps {
                sh "flutter build apk"
            }
        }
        // stage('Distribute Android APK') {
        //     steps {
        //         appCenter apiToken: 'API_TOKEN_HERE',
        //                 ownerName: 'OWNER_NAME',
        //                 appName: 'APP_NAME',
        //                 pathToApp: 'build/app/outputs/apk/release/app-arm64-v8a-release.apk',
        //                 distributionGroups: 'DISTRIBUTION_GROUP'
        //     }
        // }
        stage('Cleanup') {
            steps {
                sh "flutter clean"
            }
        }
    }
}
