def appname = "Runner" //DON'T CHANGE THIS. This refers to the flutter 'Runner' target.
def xcarchive = "${appname}.xcarchive"

pipeline {
    agent any
 environment {
        flutter = "/opt/flutter/bin/flutter"
        JAVA_HOME ="/opt/java/openjdk/"
    }
    stages {
        stage ('Flutter Doctor') {
            steps {
                sh "flutter doctor -v"
            }
        }
        stage ('Clone') {
            steps {
                sh "git clone https://github.com/mohamadassi173/weatherApp"
                sh "cd weatherApp"
            }
        }

        stage ('Flutter Test') {
            steps {
                sh "flutter test"
            }
        }

        stage ('Flutter Build APK') {
            steps {
                sh "flutter build apk"
            }
            post {
            always {
                archiveArtifacts artifacts: 'build/app/outputs/flutter-apk/app-release.apk', onlyIfSuccessful: true
                }
            }
        }

        stage ('Flutter APK deployment') {
            steps {
                sh "git add ."
                sh 'git commit build "success"'
                sh "git push"
            }
        }


    }
}
