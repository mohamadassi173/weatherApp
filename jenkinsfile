def appname = "Runner" //DON'T CHANGE THIS. This refers to the flutter 'Runner' target.
def xcarchive = "${appname}.xcarchive"

pipeline {
    agent any
 environment {
        flutter = "/opt/flutter/bin/flutter"
        JAVA_HOME ="/opt/java/openjdk/"
    }
    stages {
        stage ('Flutter Doctor') {
            steps {
                sh "flutter doctor -v"
            }
        }

        stage ('Flutter Test') {
            steps {
                sh "flutter test"
            }
        }

        stage ('Flutter Build APK') {
            steps {
                sh "flutter build apk"
            }
            post {
            always {
                archiveArtifacts artifacts: 'build/app/outputs/flutter-apk/app-release.apk', onlyIfSuccessful: true
                }
            }
        }

        stage ('Flutter APK deployment') {
            steps {
                sh "git remote rename origin old-origin"
                sh "git remote add origin https://github.com/mohamadassi173/WeatherLensApp"
                sh "git push -u origin --all"
                sh "git push -u origin --tags"
            }
        }


    }
}
